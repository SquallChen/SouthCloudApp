<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Hello MUI</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="../../css/mui.min.css">
    <link rel="stylesheet" href="../../css/common.css">
    <script src="../../js/url.js"></script>
    <style type="text/css">
        .font15{
            font-size:15px;
        }
        .pt, .neh, .llh{
            border-bottom: 1px solid #ccc;
        }


        .rightBorder{
            border-right: 1px solid #ccc;
        }

        .mui-col-sm-4, .mui-col-sm-8{
            padding-left:5px;
            height:25px;
            line-height:25px;
        }

        .pt, .pt .mui-col-sm-4, .pt .mui-col-sm-8 {
            height:42px;
            line-height:42px;
            font-size:16px;
        }

        .pt{
            background-color:#EDEDED;
        }

        .diva{
            background-color:#fff;
        }
    </style>
</head>

<body>
    <!--下拉刷新容器-->
    <div id="pullrefresh" class="mui-content mui-scroll-wrapper">
        <div class="mui-scroll">
            <!--数据列表-->
            <div class="diva">
            </div>
        </div>
    </div>
    <script src="../../js/mui.min.js"></script>
    <script src="../../js/timetrans.js"></script>
    <script>
    mui.init({
        pullRefresh: {
            container: '#pullrefresh',
            up: {
                contentrefresh: '正在加载...',
                callback: pullupRefresh
            }
        },
        gestureConfig: {
            longtap: true, //默认为false
        }
    });

    /**
     * 上拉加载具体业务实现
     */
    var page = 0;
    var page_number;
    var user_name;
    var token;
    var achieve_file_id;
    var comArray = ['确认'];

    mui.plusReady(function() {
        user_name = plus.storage.getItem("user_name");
        token = plus.storage.getItem("token");
        achieve_file_id = plus.storage.getItem("achieve_file_id");
        getData();
    });

    function pullupRefresh() {
        setTimeout(function() {
            getData();
        }, 800);
    }

    function getData() {
        mui.ajax(apiUrl.achieve_file_content_page, {
            data: {
                user_name: user_name,
                token: token,
                achieve_file_id: achieve_file_id
            },
            dataType: 'json',
            type: 'post',
            timeout: 10000,
            success: function(data) {
                if (data.status == 0) {
                    if (data.pageCount == 1) {
                        mui('#pullrefresh').pullRefresh().disablePullupToRefresh();
                    } else if (page == data.endPageIndex) {
                        mui('#pullrefresh').pullRefresh().endPullupToRefresh(true);
                    } else {
                        mui('#pullrefresh').pullRefresh().endPullupToRefresh(false);
                    }

                    if (data.recordList.length == 0 && data.currentPage == 1) {
                        mui('#pullrefresh').pullRefresh().disablePullupToRefresh();
                        mui.confirm('暂无数据!', 'SouthCloud', comArray, function(e) {
                            mui.openWindow({
                                url: 'achievelist.html',
                                id: 'achievelist.html',
                            });
                            var ws = plus.webview.getWebviewById('achievecontent');
                            plus.webview.close(ws);
                        }, 'div');
                    }
                    var table = document.body.querySelector('.diva');
                    var cells = document.body.querySelectorAll('.divb');
                    for (var i = 0; i < data.recordList.length; i++) {
                        var recordList = data.recordList[i];
                        var div = document.createElement('div');
                        div.className = 'divb';
                        div.innerHTML =
                            '<div class="mui-row font15 pt">' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">点名：' + recordList.pointName +'</div>' +
                                '<div class="mui-col-sm-8 mui-col-xs-8">时间：' + timeTrans(recordList.timeStamp * 1000, 'yyyy-MM-dd HH:mm:ss') + '</div>' +
                            '</div>' +
                            // '<div class="mui-row font15">' +
                            //     '<div class="mui-col-sm-6 mui-col-xs-6">' + 1234 + '</div>' +
                            //     '<div class="mui-col-sm-6 mui-col-xs-6">' + 1234 + '</div>' +
                            // '</div>' +
                            '<div class="mui-row font15">' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">北坐标：</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">东坐标：</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4">高程：</div>' +
                            '</div>' +
                            '<div class="mui-row font15 neh">' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">' + recordList.northing + '</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">' + recordList.easting + '</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4">' + recordList.height + '</div>' +
                            '</div>' +
                            '<div class="mui-row font15">' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">纬度：</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">经度：</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4">椭球高：</div>' +
                            '</div>' +
                            '<div class="mui-row font15 llh">' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">' + recordList.latitude + '</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4 rightBorder">' + recordList.longitude + '</div>' +
                                '<div class="mui-col-sm-4 mui-col-xs-4">' + recordList.altitude + '</div>' +
                            '</div>';
                        table.appendChild(div);
                    }
                } else if (data.status == 40004) {
                    mui.openWindow({
                        url: '../../login.html',
                        id: 'login',
                    });
                } else {
                    plus.nativeUI.toast(data.info);
                }
            },
            error: function(xhr, type, errorThrown) {
                onNetChange();
            }
        });
    }
    </script>
</body>

</html>
