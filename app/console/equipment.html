<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../css/custom.css">
		<style>
			* {
				padding: 0;
				margin: 0;
				box-sizing: border-box;
			}

			html,
			body,
			#vm {
				height: 100%;
			}

			a {
				color: #333;
			}

			.filter {
				width: 100%;
				usertitle
			}

			.filter a {
				display: block;
				width: 80%;
				height: 50px;
				line-height: 50px;
				font-size: 14px;
				padding-left: 20px;
			}

			.btn {
				background: none;
				border: none;
				color: white;
				font-size: 40px;
				line-height: 24px;
				width: 48px;
				height: 48px;
				float: right;
				right: -4px;
			}

			.filter {
				height: 102px;
				margin-bottom: 20px;
			}

			.filter ul li {
				display: flex;
				align-items: center;
				padding-left: 10px;
				padding-right: 10px;
				position: relative;
				flex-wrap: wrap;
			}

			.filter ul li img {
				width: 38px;
				height: 44px;
			}

			.filter .userentry {
				border-bottom: 1px solid #ccc;
			}

			.filter .border_bottom {
				display: block;
				width: 100%;
				height: 1px;
				background: #ccc;
				left: 30px;
				bottom: 0px;
				-webkit-transform: scaleY(.5);
			}

			.mui-bar .mui-icon {
				font-size: 32px;
			}

			.mui-bar-nav.mui-bar .mui-icon {
				/*margin-right: -10px;
				margin-left: -10px;
				padding-right: 10px;
				padding-left: 10px;
				padding-top: 23px;
				padding-bottom: 10px;
				font-weight: bold;
				font-size: 40px;*/
			}

			.mui-bar .mui-title {
				right: 50px;
				left: 50px;
			}

			.mui-content {
				background: white;
				display: flex;
				flex-direction: column;
			}

			.usertitle {
				width: 100%;
				background: #f2f2f2;
				padding-left: 20px;
				height: 36px;
				line-height: 36px;
				color: #0b60de;
				font-weight: 500;
				font-size: 14px;
			}

			.personnelInfo {
				width: 100%;
				overflow: auto;
				flex: 1;
			}

			.personnelInfo ul li {
				height: 60px;
			}

			.personnelInfo .mui-table-cell {
				display: flex;
			}

			.personnelInfo .img-content {
				width: 25%;
				display: flex;
				align-items: center;
				height: 60px;
			}

			.personnelInfo .main-content {
				width: 100%;
				padding-top: 12px;
				color: #333;
			}

			.personnelInfo .main-content :nth-child(2) {
				position: relative;
				top: -4px;
			}

			.main-content .name,
			.mui-content .group {
				font-size: 13px;
			}

			.personnelInfo .main-content .group {
				top: 4px;
			}

			.main-content .pinyin {
				font-size: 11px;
			}

			.personnelInfo img {
				width: 36px;
				height: 36px;
				border-radius: 5px;
				position: relative;
				border: 1px solid #0b60de;
			}

			.personnelInfo .main-content div {
				display: flex;
				justify-content: space-between;
			}

			.personnelInfo .status {
				position: relative;
				top: -3px;
				background: linear-gradient(to bottom, #aeaeae, #707070);
				width: 16px;
				height: 16px;
				border-radius: 50px;
				border: 1px solid white;
				box-shadow: 0px 2px 4px 1px rgba(0, 0, 0, .25);
			}

			.personnelInfo .main-content .active {
				background: linear-gradient(to bottom, #39e131, #31bd2a);
				top: -2px;
			}

			.personnelInfo .mui-slider-right a:nth-child(1) {
				background: #f87776;
			}

			.personnelInfo .mui-slider-right a:nth-child(2) {
				background: #b876f5;
			}

			.personnelInfo .mui-slider-right a:nth-child(3) {
				background: #deaa02;
			}
			.personnelInfo .mui-slider-right a:nth-child(4) {
				background: #019bdc;
			}
			.personnelInfo .mui-table-view-cell {
				padding: 0 14px 0 10px;
			}
			.mui-table-view-cell>.mui-slider-right>.mui-btn{
				padding: 0;
				width:85px;
				justify-content: center;
			}
			.mui-table-view-cell:after {
				left: 0;
				background-color: #ccc;
			}

			#topPopover .mui-table-view-cell a {
				display: flex;
				align-items: center;
				font-size: 20px;
			}

			#topPopover .mui-table-view-cell a img {
				margin-right: 20px;
			}

			#topPopover .mui-table-view-cell {
				border-bottom: 1px solid #ddd;
			}

			.mui-popover {
				height: 300px;
			}

			.mui-popover {
				width: 180px;
				height: 166px;
				box-shadow: 0 0 15px rgba(0, 0, 0, .3);
				background: white;
			}

			.mui-backdrop {
				background: transparent;
			}

			.mui-scroll-wrapper,
			.mui-popover .mui-popover-arrow:after,
			.mui-scroll-wrapper .mui-table-view-cell {
				/*background: #49484a;
				color: white;*/
			}

			.mui-popover .mui-scroll-wrapper {
				margin: 0;
			}

			.mui-popover .mui-table-view .mui-table-view-cell:last-child,
			.mui-popover .mui-table-view .mui-table-view-cell:last-child,
			.mui-popover .mui-table-view .mui-table-view-cell:last-child>a:not(.mui-btn),
			.mui-popover .mui-table-view .mui-table-view-cell:first-child>a:not(.mui-btn) {
				border-bottom-left-radius: 0;
				border-bottom-right-radius: 0;
				border-top-left-radius: 0;
				border-top-right-radius: 0;
			}

			.userEntryImg {
				display: inline-block;
				width: 22px;
				height: 22px;
				background: url(../../public/img/user_icon01.png) no-repeat;
				background-size: 19px 22px;
				margin-left: 5px;
			}

			.userfilter {
				display: inline-block;
				width: 22px;
				height: 22px;
				background: url(../../public/img/user_icon02.png) no-repeat;
				background-size: 19px 22px;
				margin-left: 5px;
			}

			.mui-content .mui-icon {
				color: #ccc;
				position: absolute;
				right: 15px;
				top: 13px;
			}

			.mui-popover .mui-table-view {
				background: white;
			}

			.mui-popover .mui-table-view {
				border-radius: 0;
			}

			.mui-popover .mui-popover-arrow:after {
				background: white;
			}

			#topPopover .mui-table-view-cell a span {
				display: inline-block;
				width: 100%;
				text-align: center;
			}
			[v-cloak] {
			  display: none;
			}
		</style>
	</head>

	<body>
		<div id="vm">
			<header class="mui-bar mui-bar-nav">
				<a id="menu" class="mui-action-menu mui-icon mui-icon-plusempty mui-pull-right lists" href="#topPopover"></a>
				<h1 class="mui-title">南方云</h1>
			</header>
			<div class="mui-content">
				<div class="filter">
					<ul class="filter-ul">
						<li href="../equipment/deviceEntry.html" class="filter-li">
							<span class="userEntryImg"></span>
							<a href="#">设备录入</a>
							<span class="mui-icon mui-icon-arrowright"></span>
							<span class="border_bottom"></span>
						</li>
						<li href="../equipment/equipmentFilter.html" class="filter-li">
							<span class="userfilter"></span>
							<a href="#">设备筛选</a>
							<span class="mui-icon mui-icon-arrowright"></span>
							<span class="border_bottom"></span>
						</li>
					</ul>
				</div>
				<div class="usertitle">
					<span>设备</span>
				</div>
				<div class="personnelInfo">
					<ul class="mui-table-view">
						<li class="mui-table-view-cell" v-for="(item,index) in deviceData">
							<div class="mui-slider-right mui-disabled">
								<a class="mui-btn" href="#" v-on:tap="openpage(index)" data-href="../personnel/realTimeTrack.html">实时轨迹</a>
								<a class="mui-btn" href="#" v-on:tap="openpage(index)" data-href="../personnel/historicalTrack.html">历史轨迹</a>
								<a class="mui-btn" href="#" v-on:tap="openpage(index)" data-href="../personnel/currentLocation.html">位置</a>
								<a class="mui-btn" href="#" v-on:tap="openpage(index)" data-href="../personnel/onlineSettings.html">在线配置</a>
							</div>
							<div class="mui-slider-handle">
								<div class="mui-table-cell">
									<div class="main-content" v-cloak>
										<div><span class="name">{{item.identifyCode}}</span><span class="status" :class="{active:item.onlineStatus!==0}"></span></div>
										<div><span class="pinyin">{{item.upDataUserName}}</span><span class="group">{{item.upDataCompanyInfo}}</span></div>
									</div>
								</div>
							</div>
						</li>
					</ul>
				</div>
			</div>

			<!--右上角弹出菜单-->
			<div id="topPopover" class="mui-popover">
				<div class="mui-popover-arrow"></div>
				<div class="mui-scroll-wrapper">
					<div class="mui-scroll">
						<ul class="mui-table-view">
							<li class="mui-table-view-cell" href="../personnel/userEntry.html">
								<a href="#">
									<span>设备关联</span></a>
							</li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/url.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script type="text/javascript">
			mui.init({
			  beforeback: function () {}
			});
			mui.plusReady(function () {});
			var vm = new Vue({
			  el: '#vm',
			  data: {
			    deviceData: '',
			    token: '',
			    test:[1,2,3,4],
			    user_name: '',
			    rtkCount: '',
			    onlineRtkCount: '',
			    mapRtk: '',
//			    upDataUserName:'',
//			    upDataCompanyInfo:'',
//			    identifyCode:'',
//			    track_day_id:'',
			  },
			  methods: {
			    openpage: function (index) {
			      var data_url = event.target.dataset.href;
			      mui.openWindow({
			        url: data_url,
			        id: data_url,
			        //用extras属性将当前index值传递到即将打开的页面
			        extras:{
				        //index:index,
				        upDataUserName:vm.deviceData[index].upDataUserName,
				        upDataCompanyInfo:vm.deviceData[index].upDataCompanyInfo,
				        identifyCode:vm.deviceData[index].identifyCode,
				        //track_day_id:vm.deviceData[index].id
				    }
			      });
			    }
			  },
			  created: function () {
			    mui.plusReady(function () {
			      mui.init({});
			      // 页面顶部筛选按钮跳转
			      mui('.filter-ul').on('tap', '.filter-li', function (e) {
			        var url = this.getAttribute('href');
			        mui.openWindow({
			          url: url,
			          id: url
			        });
			      });
			      // 右上角弹出窗链接跳转
			      mui('#topPopover .mui-table-view').on('tap', '.mui-table-view-cell', function (e) {
			        var url = this.getAttribute('href');
			        mui.openWindow({
			          url: url,
			          id: url
			        });

			        document.querySelector('#topPopover').style.display = 'none';
			        document.querySelector('.mui-backdrop').style.display = 'none';
			        document.querySelector('#topPopover').className = 'mui-popover';
			      });
			      // 登陆时存放到本地的数据
			      vm.token = plus.storage.getItem('token');
			      vm.user_name = plus.storage.getItem('user_name');
			      vm.rtkCount = plus.storage.getItem('rtkCount') || 0;
			      vm.onlineRtkCount = plus.storage.getItem('onlineRtkCount') || 0;
			      vm.mapRtk = plus.storage.getItem('mapRtk') || 0;

			      mui.ajax(apiUrl.device_list_page, {
			        data: {
			          user_name: vm.user_name,
			          token: vm.token
			        },
			        dataType: 'json',
			        type: 'post',
			        timeout: 10000,
			        success: function (data) {
			          if (data.status === 0) {
			            var tempData = data.recordList;
			            var tempArray = [];
			            //当设备onlineStatus===1（在线时），在线设备push进临时数组，原数组删除该条元素，最后将临时数组unshift回原数组，达到排列到队列前面的目的
			            for(var i=0;i<tempData.length;i++){
			            	if(tempData[i].onlineStatus===1){
			            		tempArray.push(tempData[i]);
			            		tempData.splice(i, 1);
			            	}
			            }
			            for(var i=0;i<tempArray.length;i++){
			            	tempData.unshift(tempArray[i]);
			            }
			            //完成排列处理的数组数据添加到页面上渲染
			            vm.deviceData = tempData;
//			            var a = {
//			            	b:1,
//			            	c:''
//			            }
//			            var d = [1,2,3,4];
//			            a.c = d;
//			            console.log(JSON.stringify(a))
			          } else if (data.status === 40004) {
			            mui.openWindow({
			              url: '../../login.html',
			              id: 'login'
			            });
			          } else {
			            plus.nativeUI.toast(data.info);
			            setTimeout(function () {
			              plus.nativeUI.closeWaiting();
			            }, 1000);
			          }
			        },
			        error: function (xhr, type, errorThrown) {
			          // 异常处理；
			          onNetChange();
			          plus.nativeUI.closeWaiting();
			        }
			      });

			      window.addEventListener('refresh', function () {
			        console.log('要刷新数据了！！！！');
			       // plus.webview.currentWebview().reload();
        //							 var h=plus.webview.currentWebview();
        //							console.log( "当前Webview窗口："+h.getURL() );
        //							h.reload();
			        //							console.log('刷新完数据了！！！！');

			      });
			    });
			  }
			});

		</script>
	</body>

</html>