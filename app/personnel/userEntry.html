<!DOCTYPE html>
<html class="ui-page-login">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>用户录入</title>
		<link href="../../css/mui.min.css" rel="stylesheet" />
		<link href="../../css/custom.css" rel="stylesheet" />
		<link href="../../css/input.css" rel="stylesheet" />
		<style>
			[v-cloak] {
				display: none;
			}

			.select {
				display: flex;
			}

			.select div {
				width: 65%;
			}

			.select .down {
				width: 10px;
				height: 7px;
				position: absolute;
				top: 16px;
				right: 15px;
			}

			select {
				margin-bottom: 0;
			}

			.management {
				margin-left: 6%;
				width: 88%;
				height: 50px;
				line-height: 25px;
				border-radius: 0;
				background: #3a89fb;
				color: white;
				font-size: 20px;
				margin-top: 25px;
				border: none;
				border-radius: 4px;
			}

			.management:active {
				background: #0b5fde !important;
			}

			.mui-input-row label {
				padding: 0;
				height: 40px;
				line-height: 40px;
				color: #333;
				width: 70px;
				text-align: right;
				margin-right: 25px;
			}

			.mui-input-group .mui-input-row {
				padding-left: 15px;
				position: relative;
			}

			input[type=text] {
				height: 40px;
			}

			.mui-input-row select {
				height: 40px;
			}

			.mui-input-row label~input {
				float: left;
			}

			.mui-input-group .mui-input-row:after {
				left: 0;
				background-color: #ccc;
			}

			body {
				background: #f2f2f2;
			}

			.mui-bar-nav.mui-bar .mui-icon {
				width: 73px;
				height:52px;
				top:21px;
				display: flex;
				align-items: center;
			}

			.mui-icon-back:before,
			.mui-icon-left-nav:before {
				content: '';
			}

			.back {
				display: block;
				width: 10px;
				height: 16px;
				background: url('../../public/img/back.png') no-repeat;
				background-size: 10px 16px;
				margin-left: 10px;
			}
			input::-webkit-input-placeholder{
				color:#ccc;
			}
			input:-moz-placeholder{
				color:#ccc;
			}
			input::-moz-placeholder{
				color:#ccc;
			}
		</style>
	</head>

	<body>
		<div id="app" v-cloak>
			<header class="mui-bar mui-bar-nav">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left">
					<span class="back"></span>
				</a>
				<h1 class="mui-title">用户录入</h1>
			</header>
			<div class="mui-content" style="padding-top: 94px">
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label>用户账号</label>
						<input v-model="account" id="account" type="text" class="mui-input-clear mui-input" placeholder="请输入用户账号">
					</div>
					<div class="mui-input-row">
						<label>用户名称</label>
						<input v-model="userName" id="userName" type="text" class="mui-input-clear mui-input" placeholder="请输入用户昵称">
					</div>
					<div class="mui-input-row">
						<label>真实姓名</label>
						<input v-model="realName" id="realName" type="text" class="mui-input-clear mui-input" placeholder="请输入真实姓名">
					</div>
					<div class="mui-input-row">
						<label>密码</label>
						<input v-model="password" id="password" type="text" class="mui-input-clear mui-input" placeholder="请输入密码">
					</div>
					<div class="mui-input-row">
						<label>重复密码</label>
						<input v-model="password2" id="password2" type="text" class="mui-input-clear mui-input" placeholder="请再次输入密码">
					</div>
					<div class="mui-input-row select">
						<label>组织机构</label>
						<div>
							<select name="" v-model="organizationvalue">
								<option value disabled selected>请选择组织机构...</option>
								<option v-for="item in organization" :value="item.description">{{item.departname}}</option>
							</select>
							<img src="../../public/img/dropdown.png" alt="" class="down" />
						</div>

					</div>
					<div class="mui-input-row select">
						<label>角色</label>
						<div>
							<select v-model="rolevalue">
								<option value disabled selected>请选择角色...</option>
								<option v-for="item in role" :value="item.rolecode">{{item.rolename}}</option>
							</select>
							<span>Selected: {{ role }}</span>
							<img src="../../public/img/dropdown.png" alt="" class="down" />
						</div>
					</div>
					<div class="mui-input-row">
						<label>手机号码</label>
						<input v-model="mobilePhone" id="mobilePhone" type="text" class="mui-input-clear mui-input" placeholder="请输入手机号码">
					</div>
					<div class="mui-input-row">
						<label>办公电话</label>
						<input v-model="mobile" id="mobile" type="text" class="mui-input-clear mui-input" placeholder="请输入办公电话">
					</div>
					<div class="mui-input-row">
						<label>常用邮箱</label>
						<input v-model="email" id="email" type="text" class="mui-input-clear mui-input" placeholder="请输入邮箱">
					</div>
				</form>

				<button class="management" v-on:tap="userEntry">确  定</button>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/app.js"></script>
		<script src="../../js/url.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script>
			var user_page = null;
			var vm = new Vue({
			  el: '#app',
			  user_name: '',
			  token: '',
			  data: {
			    account: '123456789',
					userName: 'xiaozhang',
					realName:'小张',
			    password: '123456',
			    password2: '123456',
			    mobilePhone: '987654321',
			    email: '',
			    mobile: '',
			    organizationvalue: '',
					rolevalue: '',
					organization:[],
					role:[],
			    // organization: [{
			    //   name: '南方卫星导航',
			    //   value: 0
			    // },
			    // {
			    //   name: '设备初始激活组织',
			    //   value: 1
			    // },
			    // {
			    //   name: '南方测绘集团总部',
			    //   value: 2
			    // },
			    // {
			    //   name: '震源导航',
			    //   value: 3
			    // },
			    // {
			    //   name: '南方质量追踪',
			    //   value: 4
			    // }
			    // ],
			    // role: [{
			    //   name: '管理员',
			    //   value: 0
			    // },
			    // {
			    //   name: '南方管理员',
			    //   value: 1
			    // },
			    // {
			    //   name: '南方外贸管理员',
			    //   value: 2
			    // },
			    // {
			    //   name: '仪器管理员',
			    //   value: 3
			    // }
			    // ]
			  },
			  methods: {
			    userEntry: function () {
						if (this.account === '') {
			        mui.toast('请输入用户账号!');
			        return;
			      }
			      if (this.userName === '') {
			        mui.toast('请输入用户名称!');
			        return;
						}
						if (this.realName === '') {
			        mui.toast('请输入真实名称!');
			        return;
			      }
			      if (this.password === '') {
			        mui.toast('请输入密码！');
			        return;
			      }
			      if (this.password2 === '') {
			        mui.toast('请再次输入密码！');
			        return;
			      }
			      if (this.password !== this.password2) {
			        mui.toast('两次密码输入不一致！');
			        return;
			      }
			      // if (this.email === '') {
			      //   mui.toast('请输入邮箱！');
			      //   return;
			      // }
			      // if (this.mobile === '') {
			      //   mui.toast('请输入办公电话！');
			      //   return;
			      // }
			      if (this.organizationvalue === '') {
			        mui.toast('请选择组织机构！');
			        return;
			      }
			      if (this.rolevalue === '') {
			        mui.toast('请选择角色！');
			        return;
						}
						if (this.mobilePhone === '') {
			        mui.toast('请输入手机号码！');
			        return;
			      }
						mui.ajax(apiUrl.add_stuff, {
			        data: {
			          user_name: plus.storage.getItem('user_name'),
								token: plus.storage.getItem('token'),
								nick_name:vm.userName,
								real_name:vm.realName,
								password:vm.password2,
								org_id:vm.organizationvalue,
								role_id:vm.rolevalue,
								mobile_phone:vm.mobilePhone,
								office_phone:vm.mobile,
								email:vm.email,
								depart_name:''
			        },
			        dataType: 'json',
			        type: 'post',
			        timeout: 10000,
			        success: function (data) {
								console.log('创建用户返回信息'+JSON.stringify(data));
			        },
			        error: function (xhr, type, errorThrown) {
			          // 异常处理；
			          plus.nativeUI.closeWaiting();
			        }
						});

			      if (user_page == null) {
                    user_page = plus.webview.getWebviewById('user.html');
                  }
                  mui.fire(user_page, 'refreshUserInfo', {
                    // 暂时没有需要传的参数
                  });
                  //plus.webview.currentWebview().close();
			    }
			  },
			  created: function () {
					mui.plusReady(function () {
						mui.ajax(apiUrl.get_depart_info, {
			        data: {
			          user_name: plus.storage.getItem('user_name'),
								token: plus.storage.getItem('token'),
			        },
			        dataType: 'json',
			        type: 'post',
			        timeout: 10000,
			        success: function (data) {
								console.log('组织信息'+JSON.stringify(data));
								vm.organization = data.departs;
								console.log('11111111111+'+JSON.stringify(vm.organization));
			        },
			        error: function (xhr, type, errorThrown) {
			          // 异常处理；
			          plus.nativeUI.closeWaiting();
			        }
						})
					});
					mui.plusReady(function () {
						mui.ajax(apiUrl.get_role_info, {
			        data: {
			          user_name: plus.storage.getItem('user_name'),
								token: plus.storage.getItem('token'),
			        },
			        dataType: 'json',
			        type: 'post',
			        timeout: 10000,
			        success: function (data) {
								console.log('角色信息'+JSON.stringify(data));
								vm.role = data.role;
			        },
			        error: function (xhr, type, errorThrown) {
			          // 异常处理；
			          plus.nativeUI.closeWaiting();
			        }
						});
					})
				}
			});

			mui.plusReady(function () {
			  mui.init({
			    beforeback: function () {}
			  });
			  vm.user_name = plus.storage.getItem('user_name');
			  vm.token = plus.storage.getItem('token');
			});
		</script>
	</body>

</html>