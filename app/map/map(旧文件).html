<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>南方云</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link rel="stylesheet" href="../../css/mui.min.css">
		<link rel="stylesheet" href="../../css/custom.css">
		<style>
			.mui-slider-indicator .mui-indicator,
			.mui-slider-indicator .mui-active.mui-indicator {
				box-shadow: none;
				width: 5px;
				height: 5px;
				margin: 0;
			}
			
			.mui-slider-indicator .mui-indicator {
				background: #ccc;
			}
			
			.mui-slider-indicator .mui-active.mui-indicator {
				background: #666;
			}
			
			.mui-grid-view.mui-grid-9 {
				background-color: #fff
			}
			
			.mui-table-view.mui-grid-9 .mui-table-view-cell.mui-active {
				background-color: #ebebeb;
			}
			
			.mui-grid-view.mui-grid-9 .mui-table-view-cell {
				border-bottom: 1px solid #e5e5e5;
				border-right: 1px solid #e5e5e5;
			}
			
			.mui-table-view.mui-grid-view .mui-table-view-cell .mui-media-body {
				vertical-align: top;
				height: 30px;
				line-height: 30px;
				font-size: 16px;
				color: #666;
			}
			
			.mui-media-body,
			.mui-media-body>img {
				width: 20px;
				height: 20px;
				margin-right: 5px;
			}
			
			.sp1 {
				font-size: 36px;
				color: #1D69BF;
			}
			
			.sp2 {
				font-size: 16px;
				color: #999;
			}
			
			.menu-wrapper>div {
				height: 120px;
				line-height: 120px;
				text-align: center;
			}
			
			.mui-off-canvas-wrap.mui-active .mui-off-canvas-backdrop {
				box-shadow: none;
			}
			
			.mui-off-canvas-left {
				background-color: #135280;
				width: 75%;
			}
			
			.slider-heaer {
				height: 100px;
				line-height: 100px;
				width: 100%;
				background: #135280 url('../../public/img/slidertop.png') no-repeat 0 center;
				padding: 8px 20px;
				margin: 0;
				color: #fff;
				font-size: 30px;
			}
			
			.slider-heaer>.mui-icon-contact {
				font-size: 50px;
			}
			
			.slider-heaer>span {
				margin-right: 12px
			}
			
			.slider-content {
				margin-top: 24px;
				border: none;
				list-style: none;
				color: #fff;
				width: 100%;
				padding: 0
			}
			
			.slider-content li {
				display: block;
				height: 50px;
				line-height: 50px;
				background-color: #135280;
				border-top: 1px solid rgba(255, 255, 255, 0.15);
				border-bottom: 1px solid rgba(255, 255, 255, 0.15);
				margin-bottom: 20px;
				padding-left: 20px;
				font-size: 18px;
				color: #fff;
			}
			
			.slider-content li i {
				margin-right: 14px;
				margin-top: 12px;
			}
			
			.mui-table-view-inverted {
				background-color: #135280;
				background: #135280;
			}
			
			.slider-content .logout {
				margin-top: 60px;
				background-color: #e36a42;
				border: none;
				padding: 0;
				text-align: center;
			}
			
			.mui-spinner {
				margin-top: 10px
			}
			
			.mui-table-view-cell {
				padding: 0;
				border: none;
			}
			
			.mui-table-view-cell:after {
				height: 0;
			}
			
			.mui-table-view-cell.mui-active {
				background-color: #0f4266;
			}
			
			.mui-popup-title+.mui-popup-text {
				font-family: inherit;
				font-size: 14px;
				margin: 5px 0 0;
				text-align: left;
			}
			
			.mui-content {
				padding-top: 0px;
			}
			
			element.style {
				padding-top: 0px;
			}
		</style>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 id="title" class="mui-title">南方云</h1>
		</header>
		<div id="offCanvasWrapper" class="mui-off-canvas-wrap mui-draggable">
			<!--主界面部分-->
			<div class="mui-inner-wrap">
				<div id="offCanvasContentScroll" class="mui-content mui-scroll-wrapper" style="padding-top: 0px;">
					<div class="mui-scroll">
						<!-- 轮播 -->
						<div id="slider" class="mui-slider">
							<div class="mui-slider-group mui-slider-loop">
								<!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="../../public/img/index_track.png">
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img src="../../public/img/index_position.png">
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img src="../../public/img/index_storage.png">
									</a>
								</div>
								<div class="mui-slider-item">
									<a href="#">
										<img src="../../public/img/index_track.png">
									</a>
								</div>
								<!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
								<div class="mui-slider-item mui-slider-item-duplicate">
									<a href="#">
										<img src="../../public/img/index_position.png">
									</a>
								</div>
							</div>
							<div class="mui-slider-indicator">
								<div class="mui-indicator mui-active"></div>
								<div class="mui-indicator"></div>
								<div class="mui-indicator"></div>
							</div>
						</div>
						<!-- 菜单 -->
						<div class="mui-row menu-wrapper">
							<ul class="mui-table-view mui-grid-view mui-grid-9">
								<li class="mui-table-view-cell mui-media mui-col-xs-6 mui-col-sm-6" href="../../app/rtkonline/rtklist.html" style="border-top: 1px solid #ccc;">
									<a href="#">
										<span class="sp1" v-text="rtkCount"></span>
										<span class="sp2">台</span>
										<div class="mui-media-body">
											<img src="../../public/img/rtk.png" align="top">设备总数</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-6 mui-col-sm-6" href="../../app/mapmonitor/rtkmap.html" style="border-top: 1px solid #ccc;">
									<a href="#">
										<span class="sp1" v-text="onlineRtkCount"></span>
										<span class="sp2">台</span>
										<div class="mui-media-body">
											<img src="../../public/img/map.png" align="top">地图在线</div>
									</a>
								</li>
								<li class="mui-table-view-cell mui-media mui-col-xs-6 mui-col-sm-6" href="../../app/datamanager/datalist.html" style="border-bottom: 1px solid #ccc;">
									<a href="#">
										<span class="sp1" v-text="dataCount"></span>
										<span class="sp2">个</span>
										<div class="mui-media-body">
											<img src="../../public/img/file.png" align="top">文件总数</div>
									</a>
								</li>

							</ul>
						</div>
					</div>
				</div>
				<div class="mui-off-canvas-backdrop"></div>
			</div>
		</div>
		<script src="../../js/mui.min.js"></script>
		<script src="../../js/url.js"></script>
		<script src="../../js/vue.min.js"></script>
		<script>
			var vm = new Vue({
				el: '#offCanvasWrapper',
				data: {
					user_name: '',
					token: '',
					rtkCount: '',
					taskCount: '',
					dataCount: 0,
					onlineRtkCount: ''
				},

				created: function() {
					mui.plusReady(function() {
						mui.init({});

						mui('.mui-scroll-wrapper').scroll({
							bounce: false,
							indicators: true // 是否显示滚动条
						});

						mui('.mui-grid-view').on('tap', '.mui-table-view-cell', function(e) {
							var url = this.getAttribute('href');
							mui.openWindow({
								url: url,
								id: url
							});
						});

						vm.token = plus.storage.getItem('token');
						vm.user_name = plus.storage.getItem('user_name');
						vm.rtkCount = plus.storage.getItem('rtkCount') || 0;
						vm.onlineRtkCount = plus.storage.getItem('onlineRtkCount') || 0;
						vm.mapRtk = plus.storage.getItem('mapRtk') || 0;

					});
				}
			});

			document.addEventListener('plusready', onPlusReady, false);

			function onPlusReady() {
				document.addEventListener('resume', onAppReume, false);
			}

			function onAppReume() {
				mui.ajax(apiUrl.apiModuleDescriptor2, {
					data: {
						user_name: vm.user_name,
						token: vm.token
					},
					dataType: 'json',
					type: 'post',
					timeout: 10000,
					success: function(data) {
						if(data.status === 0) {
							plus.storage.setItem('rtkCount', String(data.device.count));
							plus.storage.setItem('onlineRtkCount', String(data.device.onlineCount));
							// plus.storage.setItem("taskCount", String(data.task.task_count));
							plus.storage.setItem('dataCount', String(data.data.files_count));
							plus.storage.setItem('dataSize', byteTrans(data.data.files_size));
							vm.rtkCount = plus.storage.getItem('rtkCount') || 0;
							vm.onlineRtkCount = plus.storage.getItem('onlineRtkCount') || 0;
							vm.dataCount = plus.storage.getItem('dataCount') || 0;
							vm.mapRtk = plus.storage.getItem('mapRtk') || 0;
						} else if(data.status === 40004) {
							mui.openWindow({
								url: 'login.html',
								id: 'login'
							});
						} else {
							mui.toast(data.info);
						}
					}
				});
			}
		</script>
	</body>

</html>