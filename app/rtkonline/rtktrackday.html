<!doctype html>
<html>

<head>
  <meta charset="UTF-8">
  <title>历史轨迹</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
  <meta content="yes" name="apple-mobile-web-app-capable" />
  <meta content="black" name="apple-mobile-web-app-status-bar-style" />
  <meta content="telephone=no" name="format-detection" />
  <link href="../../css/mui.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../css/custom.css">
  <link rel="stylesheet" href="../../js/v4.2.0-dist/ol.css" type="text/css">
  <link rel="stylesheet" href="../../js/overlay/popupoverlay.css" type="text/css">
  <script src="../../js/jquery-3.1.1.min.js"></script>
  <script src="../../js/v4.2.0-dist/ol.js"></script>
  <style type="text/css">
    html,
    body {
      margin: 0;
      width: 100%;
      height: 100%;
    }

    #map {
      width: 100%;
      position: fixed;
      top: 48px;
      bottom: 0px;
      text-align: center;
      background: #FFFFFF;
    }

    .popup-info {
      padding: 6px 6px 0 6px;
      text-align: left;
    }

    .popup-info p {
      color: #fff;
    }
  </style>
</head>

<body>
  <header class="mui-bar mui-bar-nav">
    <a id="back" class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
    <h1 class="mui-title" id="title"></h1>
  </header>
  <div id="map" class="map"></div>
</body>
<script src="../../js/mui.min.js"></script>
<script src="../../js/url.js"></script>
<script src="../../js/overlay/popupoverlay.js"></script>
<script src="rtkhistorytrack.js"></script>
<script>
  var user_name = '';
  var token = '';
  var pointUrl = '';
  var lineUrl = '';
  var trackAnalyseId = '';
  var machineId = '';
  mui.plusReady(function () {
    mui.init({
      beforeback: function () { },
    });

    user_name = plus.storage.getItem("user_name");
    token = plus.storage.getItem("token");

    var self = plus.webview.currentWebview();
    document.getElementById('title').innerHTML = self.identify_code + '轨迹';
    trackAnalyseId = self.trackAnalyseId;
    machineId = self.machineId;
    var trackDate = self.day;
    var timestampBegin = Date.parse(new Date(trackDate + ' 00:00:00')) / 1000;
    var timestampEnd = Date.parse(new Date(trackDate + ' 23:59:59')) / 1000;

    mui.ajax(apiUrl.map_url, {
      data: {
        user_name: user_name,
        token: token,
      },
      dataType: 'json',
      type: 'post',
      timeout: 10000,
      success: function (data) {
        if (data.status === 0) {
          pointUrl = data.history_track_line;
          lineUrl = data.history_track_point;
          initHistoryVecrtorLayer(pointUrl, lineUrl, machineId, timestampBegin, timestampEnd, trackAnalyseId);
        } else {
          mui.toast(data.info);
        }
      },
      error: function (xhr, type, errorThrown) {
        onNetChange();
      }
    });
  });
</script>

</html>